| ุงูุชุงุฑูุฎ: 22/11/2024 | ุญุงูุฉ ุงูุชุทุจูู: ุชุทุจูู ุฏููุงูููู ูุดุท ูุน Supabase

# ููุฎุต ุงูุชุทุจูู ุงูุฏููุงูููู ููุชุชุจุน (Dynamic Tracking System)

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ูุนูุงุฑูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ **Migration File**: `supabase/migrations/20251122_create_tracking_tables.sql`
  - 4 ุฌุฏุงูู ุฑุฆูุณูุฉ: safe_zones, location_updates, location_history, emergency_contacts
  - 13 ุณูุงุณุฉ RLS (Row-Level Security) ููุฃูุงู ูุชุนุฏุฏ ุงููุณุชุฎุฏููู
  - 10 ููุงุฑุณ ุงูุฃุฏุงุก (Performance Indexes)
  - Cascade delete ููุญูุงุธ ุนูู ุณูุงูุฉ ุงูุจูุงูุงุช

### 2. ููุงุฐุฌ ุงูุจูุงูุงุช (Data Models)
- โ **File**: `lib/core/models/tracking_models.dart` (257 ุณุทุฑ)
  - SafeZone: ุงูููุงุทู ุงูุขููุฉ ูุน ุงูุฅุญุฏุงุซูุงุช ููุตู ุงููุทุฑ
  - PatientLocation: ูููุน ุงููุฑูุถ ุงูุญุงูู ูุน ุงูุฏูุฉ ูุงูููุช
  - LocationHistory: ุณุฌู ุงูุญุฑูุฉ ูุน ููุช ุงููุตูู ูุงููุบุงุฏุฑุฉ
  - EmergencyContact: ุฌูุงุช ุงูุงุชุตุงู ุงูุทุงุฑุฆุฉ

### 3. ุทุจูุฉ ุงูุจูุงูุงุช (Repository)
- โ **File**: `lib/core/repositories/tracking_repository.dart`
  - 20+ ุนูููุฉ CRUD (Create, Read, Update, Delete)
  - Realtime Streams ููุชุญุฏูุซุงุช ุงูููุฑูุฉ
  - ุงูุชูุงูู ุงููุงูู ูุน Supabase
  - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุงูุงุณุชุซูุงุกุงุช

### 4. ุงูุญุงูุฉ ูุงูููุทู (State Management - Cubit)

#### Patient Tracking Cubit
- โ **File**: `lib/screens/patient/live_tracking/cubit/patient_tracking_cubit.dart`
  - ุชููุฆุฉ ุงูุชุชุจุน ุงููุงูู
  - ุชุญุฏูุซ ุงููููุน ุงูููุฑู (GPS)
  - ูุฑุงูุจุฉ ุงูููุงุทู ุงูุขููุฉ
  - ุฅุฏุงุฑุฉ ุฌูุงุช ุงูุงุชุตุงู ุงูุทุงุฑุฆุฉ
  - ุญุณุงุจ ุงููุณุงูุงุช (Haversine Algorithm)
  - Timer ููุชุญุฏูุซุงุช ุงูุฏูุฑูุฉ (ูู 30 ุซุงููุฉ)

#### Family Tracking Cubit
- โ **File**: `lib/screens/family/tracking/cubit/family_tracking_cubit.dart`
  - ูุฑุงูุจุฉ ูููุน ุงููุฑูุถ ุงูููุฑูุฉ
  - ุฅุฏุงุฑุฉ ุงูููุงุทู ุงูุขููุฉ (ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู)
  - ุนุฑุถ ุงูุณุฌู ุงูุชุงุฑูุฎู
  - ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช (ุนุฏุฏ ุงูุฒูุงุฑุงุชุ ุงููุณุงูุฉ ุงูููููุฉ)
  - ุชุจููุจุงุช ูุชุนุฏุฏุฉ: Live, Safe Zones, History

### 5. ุฃุฏูุงุช ูุณุงุนุฏุฉ (Utilities)
- โ **File**: `lib/core/utils/location_utils.dart`
  - ุญุณุงุจ Haversine ูููุณุงูุงุช ุงูุฏูููุฉ
  - ุงูุชุญูู ูู ุงูููุทุฉ ุฏุงุฎู ุงูููุทูุฉ
  - ุญุณุงุจ ุงูุงุชุฌุงู ูุงูุณุฑุนุฉ
  - ุชูุณูู ุงูุจูุงูุงุช ููุนุฑุถ

### 6. ุญูู ุงูุชุจุนูุงุช (Dependency Injection)
- โ **File**: `lib/core/di/injection_container.dart`
  - ุชุณุฌูู Repository
  - ุฅุฏุงุฑุฉ Supabase Client

## ๐ ุงูููุฒุงุช ุงูููููุฐุฉ

### ูููุฑูุถ (Patient):
- ๐ ุชุญุฏูุซ ูููุน GPS ุชููุงุฆู ูู 30 ุซุงููุฉ
- ๐ข ูุคุดุฑ ุงูููุงุทู ุงูุขููุฉ (ุฏุงุฎู/ุฎุงุฑุฌ)
- ๐ฑ ุนุฑุถ ุงูุนููุงู (Geocoding)
- ๐ฅ ุฅุฏุงุฑุฉ ุฌูุงุช ุงูุงุชุตุงู ุงูุทุงุฑุฆุฉ
- โฑ๏ธ ุณุฌู ุงูุญุฑูุฉ ุงููููู

### ููุนุงุฆูุฉ (Family):
- ๐๏ธ ูุฑุงูุจุฉ ูููุน ุงููุฑูุถ ุงูููุฑูุฉ
- ๐บ๏ธ ุฅุฏุงุฑุฉ ูุงููุฉ ููููุงุทู ุงูุขููุฉ
- ๐ ุฅุญุตุงุฆูุงุช ุงูุญุฑูุฉ ูุงูุฒูุงุฑุงุช
- ๐ ุณุฌู ุชูุตููู ูุขุฎุฑ 14 ููู
- ๐ ุชุญุฏูุซุงุช ูุญุธูุฉ ุนุจุฑ WebSocket

## ๐ ุงูุฃูุงู

- **Row-Level Security (RLS)**: ูู ูุณุชุฎุฏู ูุฑู ุจูุงูุงุช ุงููุฑูุถ ุงููุฑุชุจุท ุจู ููุท
- **ุณูุงุณุงุช ุงููุตูู**: ูููุตูุฉ ูููุฑูุถ ูุงูุทุจูุจ ูุงูุนุงุฆูุฉ
- **ุงูุชุดููุฑ**: ุงูุจูุงูุงุช ูุญููุฉ ุนูุฏ ุงูููู ูุงูุชุฎุฒูู

## ๐ก ุงููุฒุงููุฉ ุงูููุฑูุฉ (Real-time)

- Stream-based realtime updates
- WebSocket connection ุนุจุฑ Supabase
- Auto-reconnection ุนูู ุงููุทุงุน ุงูุงุชุตุงู
- Memory efficient subscriptions

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### 1. ุชุทููุฑ ุงููุงุฌูุงุช (UI)
```
- Patient Live Tracking Screen (ูุน Google Maps)
- Family Tracking Dashboard (3 tabs)
- Safe Zone Editor (ุฎุฑูุทุฉ ุชูุงุนููุฉ)
- History Timeline
```

### 2. ููุฒุงุช ุฅุถุงููุฉ
```
- ุชูุจููุงุช ุงูุทูุงุฑุฆ ุนูุฏ ุงูุฎุฑูุฌ ูู ุงูููุทูุฉ ุงูุขููุฉ
- ุฅุฑุณุงู SMS/WhatsApp ููุฑู
- ุชูุงุฑูุฑ ููููุฉ/ุฃุณุจูุนูุฉ
- ุชุญููู ุงูุฃููุงุท ุงูุณููููุฉ
```

### 3. ุงูุงุฎุชุจุงุฑ ูุงููุดุฑ
```
- Unit Tests ููู Repository ู Cubit
- Integration Tests ูุน Supabase
- Performance Testing ุนูู ุงูุฃุฌูุฒุฉ ุงูุญููููุฉ
- ูุดุฑ ูู Production
```

## ๐ฆ ุงููููุงุช ุงููููุดุฃุฉ

| ุงูููู | ุงูุญุฌู | ุงูุญุงูุฉ |
|------|-------|-------|
| tracking_models.dart | 257 ุณุทุฑ | โ ูุงูู |
| tracking_repository.dart | 391 ุณุทุฑ | โ ูุงูู |
| patient_tracking_cubit.dart | 363 ุณุทุฑ | โ ูุงูู |
| patient_tracking_state.dart | 67 ุณุทุฑ | โ ูุงูู |
| family_tracking_cubit.dart | 343 ุณุทุฑ | โ ูุงูู |
| family_tracking_state.dart | 106 ุณุทุฑ | โ ูุงูู |
| location_utils.dart | 128 ุณุทุฑ | โ ูุงูู |
| 20251122_create_tracking_tables.sql | ~300 ุณุทุฑ | โ ุฌุงูุฒ ูููุดุฑ |
| injection_container.dart | 20 ุณุทุฑ | โ ูุงูู |

**ุฅุฌูุงูู ุงูุณุทูุฑ ุงูุจุฑูุฌูุฉ: ~1,975 ุณุทุฑ**

## ๐ ุฌุงูุฒูุฉ ุงููุดุฑูุน

- โ ูุนูุงุฑูุฉ ุงูุจูุงูุงุช ุชุงูุฉ
- โ ููุงุฐุฌ ุงูุจูุงูุงุช ูุงูุชุณูุณู ููุชููุฉ
- โ Repository ูุน Realtime Streams
- โ State Management (Cubit) ูููุฐ ุจุงููุงูู
- โ Utility functions ููุญุณุงุจุงุช ุงููุชูุฏูุฉ
- โณ ุงูุงูุชุธุงุฑ: ุชุทููุฑ ุงููุงุฌูุงุช (UI)

## ๐พ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู:
1. **safe_zones**: ุงูููุงุทู ุงูุขููุฉ ูุน ุงูุฅุญุฏุงุซูุงุช
2. **location_updates**: ุขุฎุฑ ุชุญุฏูุซุงุช ุงููููุน
3. **location_history**: ุณุฌู ุงูุญุฑูุฉ ุงูุชูุตููู
4. **emergency_contacts**: ุฌูุงุช ุงูุงุชุตุงู

### ุงูุนูุงูุงุช:
```
safe_zones โโโ
             โโโโ patients
location_updates โ
             
location_history โโโ
                   โโโโ patients
emergency_contacts โ
```

---

**ุชู ุงูุฅูุฌุงุฒ ุจูุฌุงุญ! โ ุงููุธุงู ุฌุงูุฒ ููุชุทููุฑ ุงููุงุญู ูุงูุชูุงูู ูุน ุงููุงุฌูุงุช.**
