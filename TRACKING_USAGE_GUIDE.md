| Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 22/11/2024 | Ø§Ù„Ù†Ø³Ø®Ø©: 1.0 | Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬ âœ…

# Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ (Dynamic Tracking System)

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©](#Ø§Ù„Ø¨Ù†ÙŠØ©-Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©)
3. [Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª](#Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª)
4. [Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ†](#Ø§Ù„ØªØ«Ø¨ÙŠØª-ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ†)
5. [Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…](#Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…)
6. [Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©](#Ø£Ù…Ø«Ù„Ø©-Ø¹Ù…Ù„ÙŠØ©)
7. [Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡](#Ù…Ø¹Ø§Ù„Ø¬Ø©-Ø§Ù„Ø£Ø®Ø·Ø§Ø¡)
8. [Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª](#Ø§Ù„Ø£Ø¯Ø§Ø¡-ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª)

---

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

Ù†Ø¸Ø§Ù… Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ ÙŠÙˆÙØ± ØªØªØ¨Ø¹ ÙÙˆØ±ÙŠ ÙˆØ¢Ù…Ù† Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¢Ù…Ù†Ø© ÙˆØ§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ. ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰:

- **Supabase**: Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª PostgreSQL Ù…Ø¹ Realtime
- **Flutter BLoC**: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
- **Google Maps**: Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±Ø§Ø¦Ø· Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
- **Geolocator**: Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙÙˆØ±ÙŠØ©

---

## Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù…Ø§Ø±ÙŠØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Presentation Layer                  â”‚
â”‚  (PatientLiveTrackingScreen, FamilyTrackingScreen)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            State Management Layer (Cubit)            â”‚
â”‚  (PatientTrackingCubit, FamilyTrackingCubit)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Repository Pattern Layer                â”‚
â”‚            (TrackingRepository)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Data Layer (Supabase)                   â”‚
â”‚  (PostgreSQL, PostgRES Realtime, RLS Policies)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª

### 1. Dependencies
```yaml
dependencies:
  flutter: ">=3.0.0"
  cupertino_icons: ^1.0.2
  supabase_flutter: ^2.10.3
  flutter_bloc: ^9.1.1
  bloc: ^8.1.0
  equatable: ^2.0.5
  geolocator: ^10.1.0
  geocoding: ^4.0.0
  google_maps_flutter: ^2.5.0
  get_it: ^8.0.3
```

### 2. Android Permissions
```xml
<!-- android/app/src/main/AndroidManifest.xml -->
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
<uses-permission android:name="android.permission.INTERNET" />
```

### 3. iOS Permissions
```plist
<!-- ios/Runner/Info.plist -->
<key>NSLocationWhenInUseUsageDescription</key>
<string>Ù†Ø­ØªØ§Ø¬ Ù„ÙˆØµÙˆÙ„Ùƒ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹Ùƒ</string>
<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>Ù†Ø­ØªØ§Ø¬ Ù„ÙˆØµÙˆÙ„Ùƒ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø¦Ù…Ù‹Ø§</string>
```

---

## Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ†

### 1. ØªÙ‡ÙŠØ¦Ø© Supabase
```dart
// lib/main.dart
import 'package:supabase_flutter/supabase_flutter.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  await Supabase.initialize(
    url: 'https://your-project.supabase.co',
    anonKey: 'your-anon-key',
  );
  
  setupDependencies(); // Ù…Ù† injection_container.dart
  
  runApp(const MyApp());
}
```

### 2. Ù†Ø´Ø± Ø§Ù„Ù…Ù‡Ø§Ø¬Ø±Ø©
```bash
# ÙÙŠ Supabase Console:
# 1. Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ SQL Editor
# 2. Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ 20251122_create_tracking_tables.sql
# 3. Ù†ÙØ° Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
```

### 3. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ Realtime
```sql
-- ÙÙŠ Supabase Console SQL Editor:
ALTER PUBLICATION supabase_realtime ADD TABLE safe_zones;
ALTER PUBLICATION supabase_realtime ADD TABLE location_updates;
ALTER PUBLICATION supabase_realtime ADD TABLE location_history;
```

---

## Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Ù„Ù„Ù…Ø±ÙŠØ¶ (Patient)

#### 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù€ Cubit
```dart
class PatientScreen extends StatelessWidget {
  final String patientId;

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (context) => PatientTrackingCubit(
        getIt<TrackingRepository>(),
        patientId,
      )..initializeTracking(),
      child: const PatientLiveTrackingScreen(),
    );
  }
}
```

#### 2. Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø­Ø§Ù„Ø©
```dart
BlocListener<PatientTrackingCubit, PatientTrackingState>(
  listener: (context, state) {
    if (state.errorMessage != null) {
      // Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø·Ø£
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text(state.errorMessage!)),
      );
    }
  },
  child: BlocBuilder<PatientTrackingCubit, PatientTrackingState>(
    builder: (context, state) {
      // Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
      return Column(
        children: [
          // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
          if (state.currentPosition != null)
            Text('Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: ${state.currentPosition!.latitude}'),
          
          // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø§Ù†
          Text(state.isInsideSafeZone ? 'âœ… Ø¢Ù…Ù†' : 'âš ï¸ ØºÙŠØ± Ø¢Ù…Ù†'),
          
          // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¢Ù…Ù†Ø©
          ListView.builder(
            itemCount: state.safeZones.length,
            itemBuilder: (context, index) {
              final zone = state.safeZones[index];
              return SafeZoneCard(zone: zone);
            },
          ),
        ],
      );
    },
  ),
);
```

#### 3. Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
```dart
final cubit = context.read<PatientTrackingCubit>();

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙŠØ¯ÙˆÙŠÙ‹Ø§
await cubit.refreshLocation();

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø©
await cubit.addSafeZone(
  name: 'Ø§Ù„Ø¨ÙŠØª',
  latitude: 30.0444,
  longitude: 31.2357,
  radiusMeters: 500,
  address: 'Ø´Ø§Ø±Ø¹ Ø§Ù„Ù†ÙŠÙ„ØŒ Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
);

// ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø©
await cubit.updateSafeZone(updatedZone);

// Ø­Ø°Ù Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø©
await cubit.deleteSafeZone(zoneId);

// ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ù…Ù†Ø·Ù‚Ø©
await cubit.toggleSafeZone(zoneId, true);

// Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø§ØªØµØ§Ù„ Ø·Ø§Ø±Ø¦Ø©
await cubit.addEmergencyContact(
  name: 'Ø§Ù„Ø£Ù…',
  phone: '01012345678',
  relationship: 'mother',
  isPrimary: true,
);
```

---

### Ù„Ù„Ø¹Ø§Ø¦Ù„Ø© (Family)

#### 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù€ Cubit
```dart
class FamilyScreen extends StatelessWidget {
  final String patientId;

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (context) => FamilyTrackingCubit(
        getIt<TrackingRepository>(),
        patientId,
      )..initializeTracking(),
      child: const FamilyTrackingScreen(),
    );
  }
}
```

#### 2. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
```dart
// ÙÙŠ Ø§Ù„Ù€ UI
TabBar(
  onTap: (index) {
    final tabs = [
      TrackingTab.live,
      TrackingTab.safeZones,
      TrackingTab.history,
    ];
    context.read<FamilyTrackingCubit>().selectTab(tabs[index]);
  },
  tabs: const [
    Tab(text: 'Ø§Ù„ØªØªØ¨Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±'),
    Tab(text: 'Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¢Ù…Ù†Ø©'),
    Tab(text: 'Ø§Ù„Ø³Ø¬Ù„'),
  ],
);
```

#### 3. Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
```dart
final cubit = context.read<FamilyTrackingCubit>();

// Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø©
await cubit.addSafeZone(
  name: 'Ø§Ù„Ù…Ø¯Ø±Ø³Ø©',
  latitude: 30.0,
  longitude: 31.0,
  radiusMeters: 300,
);

// ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø·Ù‚Ø©
await cubit.updateSafeZone(updatedZone);

// Ø­Ø°Ù Ù…Ù†Ø·Ù‚Ø©
await cubit.deleteSafeZone(zoneId);

// ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ù…Ù†Ø·Ù‚Ø©
await cubit.toggleSafeZone(zoneId, false);

// ØªØ­Ø¯ÙŠØ¯ Ù…Ù†Ø·Ù‚Ø© Ù„Ù„ØªØ­Ø±ÙŠØ±
cubit.selectZoneForEditing(zone);

// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø±ÙŠØ±
cubit.cancelEditing();
```

---

## Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©

### Ù…Ø«Ø§Ù„ 1: Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
```dart
BlocBuilder<PatientTrackingCubit, PatientTrackingState>(
  builder: (context, state) {
    return GoogleMap(
      initialCameraPosition: CameraPosition(
        target: LatLng(
          state.currentPosition?.latitude ?? 0,
          state.currentPosition?.longitude ?? 0,
        ),
        zoom: 15,
      ),
      markers: {
        // Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        Marker(
          markerId: const MarkerId('current'),
          position: LatLng(
            state.currentPosition!.latitude,
            state.currentPosition!.longitude,
          ),
          icon: BitmapDescriptor.defaultMarker,
        ),
        // Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¢Ù…Ù†Ø©
        ...state.safeZones.map((zone) {
          return Marker(
            markerId: MarkerId('zone-${zone.id}'),
            position: LatLng(zone.latitude, zone.longitude),
            icon: BitmapDescriptor.defaultMarkerWithHue(
              zone.isActive
                  ? BitmapDescriptor.hueGreen
                  : BitmapDescriptor.hueRed,
            ),
          );
        }),
      },
      circles: state.safeZones
          .where((z) => z.isActive)
          .map((zone) {
        return Circle(
          circleId: CircleId('circle-${zone.id}'),
          center: LatLng(zone.latitude, zone.longitude),
          radius: zone.radiusMeters,
          fillColor: Colors.blue.withOpacity(0.2),
          strokeColor: Colors.blue,
        );
      }).toSet(),
    );
  },
);
```

### Ù…Ø«Ø§Ù„ 2: Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø£Ù…Ø§Ù†
```dart
BlocBuilder<PatientTrackingCubit, PatientTrackingState>(
  builder: (context, state) {
    return Material(
      child: state.isInsideSafeZone
          ? Container(
              color: Colors.green.withOpacity(0.1),
              child: const Text('âœ… Ø¯Ø§Ø®Ù„ Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø©'),
            )
          : Container(
              color: Colors.red.withOpacity(0.1),
              child: const Text('âš ï¸ Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¢Ù…Ù†Ø©'),
            ),
    );
  },
);
```

### Ù…Ø«Ø§Ù„ 3: Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„
```dart
BlocBuilder<FamilyTrackingCubit, FamilyTrackingState>(
  builder: (context, state) {
    return ListView.builder(
      itemCount: state.locationHistory.length,
      itemBuilder: (context, index) {
        final entry = state.locationHistory[index];
        return ListTile(
          title: Text(entry.placeName ?? 'Unknown'),
          subtitle: Text(
            'ÙˆØµÙˆÙ„: ${entry.arrivedAt.hour}:${entry.arrivedAt.minute}',
          ),
          trailing: entry.departedAt != null
              ? Text('Ù…ØºØ§Ø¯Ø±Ø©: ${entry.departedAt!.hour}:${entry.departedAt!.minute}')
              : const Text('Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù‡Ù†Ø§'),
        );
      },
    );
  },
);
```

---

## Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### 1. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
```dart
try {
  await cubit.refreshLocation();
} catch (e) {
  if (e.toString().contains('denied')) {
    // ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
    await Geolocator.openLocationSettings();
  }
}
```

### 2. Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„
```dart
BlocListener<PatientTrackingCubit, PatientTrackingState>(
  listener: (context, state) {
    if (state.errorMessage?.contains('connection') ?? false) {
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
      Future.delayed(const Duration(seconds: 5), () {
        context.read<PatientTrackingCubit>().refreshLocation();
      });
    }
  },
  child: SizedBox.shrink(),
);
```

### 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Realtime
```dart
// ÙŠØªÙ… Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù€ Cubit:
_safeZonesSubscription = _trackingRepository
    .watchSafeZones(_patientId)
    .listen(
      (zone) { /* Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */ },
      onError: (e) {
        emit(state.copyWith(
          errorMessage: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©: $e',
        ));
      },
    );
```

---

## Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª

### 1. ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©
```dart
// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© ÙÙ‚Ø·
_locationUpdateTimer = Timer.periodic(
  const Duration(seconds: 30),
  (_) async => await _updateLocation(),
);

// Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø§Ø´Ø©
@override
void close() {
  _locationUpdateTimer?.cancel();
  _safeZonesSubscription?.cancel();
  return super.close();
}
```

### 2. ØªØ­Ø³ÙŠÙ† Ø³Ø±Ø¹Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
```dart
// Ø§Ø³ØªØ®Ø¯Ø§Ù… caching Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
class TrackingRepository {
  Map<String, SafeZone> _zoneCache = {};
  
  Future<SafeZone> getSafeZone(String id) async {
    if (_zoneCache.containsKey(id)) {
      return _zoneCache[id]!;
    }
    // ... Ø¬Ù„Ø¨ Ù…Ù† Ø§Ù„Ù€ Database
  }
}
```

### 3. Ø­Ø¯ Ù…Ù† Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
```dart
// Ø§Ø³ØªØ®Ø¯Ø§Ù… pagination Ù„Ù„Ø³Ø¬Ù„
Future<List<LocationHistory>> getLocationHistory(
  String patientId, {
  required int days,
  int limit = 50,
}) async {
  // Ø¬Ù„Ø¨ Ø¢Ø®Ø± 50 Ø¹Ù†ØµØ± ÙÙ‚Ø·
}
```

---

## Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©

### âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²:
- [x] Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (4 Ø¬Ø¯Ø§ÙˆÙ„ + RLS)
- [x] Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
- [x] Repository Ù…Ø¹ Realtime
- [x] State Management (Cubit)
- [x] Utility Functions
- [x] Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
- [x] Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### â³ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±:
- [ ] ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
- [ ] Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
- [ ] Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„Ø©

---

**ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«**: 22/11/2024
**Ø§Ù„Ù†Ø³Ø®Ø©**: 1.0
**Ø§Ù„Ø­Ø§Ù„Ø©**: âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬
